# Claude Code Hook - Interactive Lint & Translate

## 개요

Claude Code 사용 종료 시 실행되는 대화형 훅입니다. 변경된 파일에 대해 ESLint, Stylelint, i18n 업데이트 작업을 사용자가 선택하여 실행할 수 있습니다.

## 주요 기능

### 1. 🎯 선택적 실행
- 사용자가 원하는 작업만 선택 가능
- 숫자 입력으로 간편한 선택 (예: `1,3`)
- `all` 명령으로 전체 작업 실행
- `n` 또는 `skip`으로 건너뛰기

### 2. ⚡ 병렬 실행
- 선택된 작업들을 동시에 실행
- 빠른 피드백
- 각 작업의 독립적 실행

### 3. 📊 명확한 결과 표시
- 각 작업의 성공/실패 상태
- 에러 메시지 상세 표시
- 수정 방법 안내

### 4. 🔄 유연한 오류 처리
- 에러 발생 시에도 계속 진행 가능
- 사용자가 최종 결정

## 사용 예시

### 기본 사용

```bash
🔍 변경된 파일 분석 완료
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  • JS/TS 파일: 5개
  • CSS/SCSS 파일: 2개

실행 가능한 작업:
  1. ESLint (JS/TS 파일 검사)
  2. Stylelint (CSS 파일 검사)
  3. i18n 번역 업데이트

실행할 작업을 선택하세요:
  - 숫자를 입력 (예: 1,3)
  - all: 모든 작업 실행
  - n 또는 skip: 건너뛰기

선택: 1,3
```

### 선택 옵션

| 입력 | 동작 |
|------|------|
| `1` | 첫 번째 작업만 실행 |
| `1,3` | 첫 번째와 세 번째 작업 실행 |
| `all` | 모든 작업 실행 |
| `n` 또는 `skip` | 작업 건너뛰기 |
| (빈 입력) | 작업 건너뛰기 |

### 실행 결과

#### 성공 케이스
```bash
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
실행 결과:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  ✅ ESLint: 통과
  ✅ i18n: 업데이트 필요한 파일 발견

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 모든 작업이 성공적으로 완료되었습니다!
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

#### 에러 케이스
```bash
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
실행 결과:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  ❌ ESLint: 오류 발견
  ✅ i18n: 업데이트 필요한 파일 발견

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⚠️  일부 작업이 실패했습니다
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

▸ eslint 오류:

  /path/to/file.js
    10:5  error  'foo' is not defined  no-undef
    15:8  error  Missing semicolon     semi

수정 명령어:
  yarn eslint --fix [파일명]

계속 진행하시겠습니까? (y/n): 
```

## 지원하는 작업

### 1. ESLint
- **조건**: JS/TS 파일이 변경된 경우
- **실행**: `npx eslint --quiet [변경된 파일들]`
- **수정**: `yarn eslint --fix [파일명]`

### 2. Stylelint
- **조건**: CSS/SCSS 파일이 변경된 경우
- **실행**: `npx stylelint [변경된 파일들]`
- **수정**: `yarn stylelint --fix [파일명]`

### 3. i18n 번역 업데이트
- **조건**: JS/TS 파일에 `t(` 또는 `i18Key(`가 포함된 경우
- **안내**: 업데이트가 필요한 파일 목록 표시
- **수정**: `yarn i18n-extract`

## 동작 조건

다음 조건을 모두 만족할 때만 훅이 실행됩니다:

1. ✅ Git 저장소 내부
2. ✅ `package.json` 파일 존재 (프로젝트 확인)
3. ✅ 변경된 파일 존재 (`git status`)
4. ✅ `stop_hook_active`가 false (무한 루프 방지)

## 설치 및 설정

### 위치
```
~/.claude/hooks/stop-hook-lint-and-translate.sh
```

### 권한
```bash
chmod +x ~/.claude/hooks/stop-hook-lint-and-translate.sh
```

### Claude Code 설정
Claude Code가 자동으로 이 훅을 인식하고 실행합니다.

## 병렬 실행 구조

```
사용자 선택 (1,3)
    ↓
┌─────────────┐
│ Task 병렬화 │
└─────────────┘
    ↓
┌──────────────┬──────────────┐
│  ESLint      │  i18n        │
│  (백그라운드)│  (백그라운드) │
└──────────────┴──────────────┘
    ↓            ↓
┌──────────────┬──────────────┐
│ 결과 수집    │ 결과 수집     │
└──────────────┴──────────────┘
    ↓
┌─────────────┐
│ 통합 결과   │
│ 표시        │
└─────────────┘
```

## 기술 상세

### 임시 파일 사용
- 각 작업의 결과를 임시 파일에 저장
- 병렬 실행 중 데이터 충돌 방지
- 종료 시 자동 정리 (`trap`)

### 프로세스 관리
```bash
declare -A PIDS
run_eslint &
PIDS[eslint]=$!
wait ${PIDS[eslint]}
```

### 색상 코드
- 🔵 파란색: 정보 메시지
- 🟢 초록색: 성공 메시지
- 🟡 노란색: 경고 메시지
- 🔴 빨간색: 오류 메시지

## 문제 해결

### 작업이 실행되지 않아요
1. Git 저장소인지 확인
2. `package.json` 존재 확인
3. 파일이 실제로 변경되었는지 확인: `git status`

### 특정 작업이 목록에 나타나지 않아요
- **ESLint**: JS/TS 파일이 변경되지 않음
- **Stylelint**: CSS/SCSS 파일이 변경되지 않음
- **i18n**: `t(` 또는 `i18Key(` 사용하는 파일 없음

### 무한 루프가 발생해요
- `stop_hook_active` 플래그로 방지
- 발생 시 스크립트가 자동으로 중단됨

## 향후 개선 계획

- [ ] 설정 파일 지원 (기본 선택 저장)
- [ ] 타임아웃 설정
- [ ] 캐싱 기능
- [ ] 증분 검사
- [ ] 더 다양한 린터 지원

## 변경 이력

### v2.0.0 (2025-11-13)
- ✨ 대화형 선택 기능 추가
- ⚡ 병렬 실행 구현
- 📊 향상된 결과 표시
- 🔄 유연한 오류 처리

### v1.0.0 (이전)
- 기본 자동 실행 기능
